{"version":3,"sources":["Config.js","App.js","index.js"],"names":["AmplifyConfig","API","endpoints","name","endpoint","Amplify","configure","config","Logger","LOG_LEVEL","console","log","App","meetingManager","useMeetingManager","useState","messages","setMessages","message","setMessage","meetingStatus","useMeetingStatus","audioVideo","useAudioVideo","meetingId","setMeetingId","toggleVideo","useLocalVideo","scrollRef","useRef","useEffect","length","current","scrollTop","scrollHeight","MeetingStatus","Succeeded","tog","realtimeSubscribeToReceiveDataMessage","data","json","incomingMessage","timestamp","Date","now","isSelf","realtimeUnsubscribeFromReceiveDataMessage","sendMessage","payload","localMessage","JSON","stringify","realtimeSendDataMessage","JoinButtonProps","icon","onClick","event","handleJoin","label","LeaveButtonProps","handleLeave","EndButtonProps","handleEnd","leave","preventDefault","post","body","joinResponse","meetingSessionConfiguration","MeetingSessionConfiguration","Meeting","Attendee","options","deviceLabels","DeviceLabels","AudioAndVideo","join","start","invokeDeviceProvider","MeetingId","title","id","style","padding","height","width","boxSizing","gridGap","gridTemplateColumns","md","ref","overflowY","map","variant","marginLeft","marginTop","toLocaleTimeString","showTail","showLabels","responsive","layout","css","value","onChange","target","onKeyPress","key","placeholder","rootElement","document","getElementById","createRoot","render","theme","lightTheme"],"mappings":"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","file":"static/js/main.f139987f.chunk.js","sourcesContent":["export const AmplifyConfig = {\n  API: {\n    endpoints: [\n      {\n        name: \"meetingApi\",\n        endpoint: \"https://tfkjfz4i18.execute-api.us-east-1.amazonaws.com/prod/\"\n      }\n    ]\n  }\n};\n","import React, { useState, useEffect, useRef } from \"react\";\nimport {\n  useMeetingManager,\n  ControlBar,\n  ControlBarButton,\n  Remove,\n  Meeting,\n  LeaveMeeting,\n  AudioInputControl,\n  DeviceLabels,\n  Grid,\n  ChatBubble,\n  VideoInputControl,\n  Input,\n  AudioOutputControl,\n  Flex,\n  MeetingStatus,\n  VideoTileGrid,\n  useMeetingStatus,\n  useAudioVideo,\n  useLocalVideo\n} from \"amazon-chime-sdk-component-library-react\";\nimport { MeetingSessionConfiguration } from \"amazon-chime-sdk-js\";\nimport NorthStarThemeProvider from \"aws-northstar/components/NorthStarThemeProvider\";\nimport Header from \"aws-northstar/components/Header\";\nimport { AmplifyConfig as config } from \"./Config\";\nimport { Amplify, API } from \"aws-amplify\";\nimport \"@aws-amplify/ui-react/styles.css\";\nAmplify.configure(config);\nAmplify.Logger.LOG_LEVEL = \"DEBUG\";\nconsole.log(config.API);\n\nconst App = () => {\n  const meetingManager = useMeetingManager();\n  const [messages, setMessages] = useState([]);\n  const [message, setMessage] = useState(\"\");\n  const meetingStatus = useMeetingStatus();\n  const audioVideo = useAudioVideo();\n  const [meetingId, setMeetingId] = useState(\"\");\n  const { toggleVideo } = useLocalVideo();\n  const scrollRef = useRef(null);\n\n  useEffect(() => {\n    if (messages.length === 0) {\n      return;\n    }\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [messages.length]);\n\n  useEffect(() => {\n    async function tog() {\n      if (meetingStatus === MeetingStatus.Succeeded) {\n        await toggleVideo();\n      }\n    }\n    tog();\n  }, [meetingStatus]);\n\n  useEffect(() => {\n    if (!audioVideo) {\n      console.log(\"No audioVideo\");\n      return;\n    }\n    console.log(\"Audio Video found\");\n    audioVideo.realtimeSubscribeToReceiveDataMessage(\"Message\", (data) => {\n      console.log(data);\n      const receivedData = (data && data.json()) || {};\n      const { message } = receivedData;\n      var incomingMessage = {\n        message: message,\n        timestamp: Date.now(),\n        isSelf: false\n      };\n      setMessages((messages) => [...messages, incomingMessage]);\n      console.log(message);\n    });\n\n    return () => {\n      audioVideo.realtimeUnsubscribeFromReceiveDataMessage(\"Message\");\n    };\n  }, [audioVideo]);\n\n  const handleMessageChange = (event) => {\n    setMessage(event.target.value);\n  };\n\n  const handleKeyPress = (event) => {\n    if (event.key === \"Enter\") {\n      sendMessage(message);\n      setMessage(\"\");\n    }\n  };\n\n  const sendMessage = (message) => {\n    if (!audioVideo) {\n      return;\n    }\n    const DATA_MESSAGE_LIFETIME_MS = 30000;\n\n    const payload = {\n      message: message\n    };\n\n    var localMessage = {\n      message: message,\n      timestamp: Date.now(),\n      isSelf: true\n    };\n    setMessages((messages) => [...messages, localMessage]);\n    console.log(`Sending message: ${JSON.stringify(payload)}`);\n    audioVideo.realtimeSendDataMessage(\n      \"Message\",\n      payload,\n      DATA_MESSAGE_LIFETIME_MS\n    );\n  };\n\n  const JoinButtonProps = {\n    icon: <Meeting />,\n    onClick: (event) => handleJoin(event),\n    label: \"Join\"\n  };\n\n  const LeaveButtonProps = {\n    icon: <LeaveMeeting />,\n    onClick: (event) => handleLeave(event),\n    label: \"Leave\"\n  };\n\n  const EndButtonProps = {\n    icon: <Remove />,\n    onClick: (event) => handleEnd(event),\n    label: \"End\"\n  };\n\n  const handleLeave = async () => {\n    await meetingManager.leave();\n  };\n\n  const handleEnd = async (event) => {\n    event.preventDefault();\n    try {\n      await API.post(\"meetingApi\", \"end\", { body: { meetingId: meetingId } });\n      setMessages([]);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const handleJoin = async (event) => {\n    event.preventDefault();\n    try {\n      const joinResponse = await API.post(\"meetingApi\", \"join\", {});\n      const meetingSessionConfiguration = new MeetingSessionConfiguration(\n        joinResponse.Meeting,\n        joinResponse.Attendee\n      );\n\n      const options = {\n        deviceLabels: DeviceLabels.AudioAndVideo\n      };\n\n      await meetingManager.join(meetingSessionConfiguration, options);\n      await meetingManager.start();\n      meetingManager.invokeDeviceProvider(DeviceLabels.AudioAndVideo);\n      setMeetingId(joinResponse.Meeting.MeetingId);\n      // setAttendeeId(joinResponse.Attendee.AttendeeId);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  return (\n    <NorthStarThemeProvider>\n      <Header title=\"Amazon Chime SDK Meeting with Chat\" />\n\n      <div id=\"video\">\n        <div\n          style={{\n            padding: \"1rem\",\n            height: \"640px\",\n            width: \"1080px\",\n            boxSizing: \"border-box\"\n          }}\n        >\n          <Grid\n            gridGap={[\".25rem\", \".5rem\"]}\n            gridTemplateColumns={{\n              md: \"3fr 1fr 4rem\"\n            }}\n          >\n            <VideoTileGrid />\n            <div ref={scrollRef} style={{ overflowY: \"auto\" }}>\n              <Flex>\n                {messages.map((message) => (\n                  <ChatBubble\n                    variant={message.isSelf ? \"outgoing\" : \"incoming\"}\n                    key={message.timestamp}\n                    marginLeft=\"1rem\"\n                    marginTop=\"1rem\"\n                    timestamp={new Date(message.timestamp).toLocaleTimeString()}\n                    showTail={message.isSelf ? true : false}\n                  >\n                    {message.message}\n                  </ChatBubble>\n                ))}\n              </Flex>\n            </div>\n          </Grid>\n        </div>\n      </div>\n      <div\n        style={{\n          padding: \"1rem\",\n          height: \"20px\",\n          width: \"1080px\",\n          boxSizing: \"border-box\"\n        }}\n      >\n        <Grid\n          gridGap={[\".25rem\", \".5rem\"]}\n          gridTemplateColumns={{\n            md: \"3fr 1fr 4rem\"\n          }}\n        >\n          {\" \"}\n          <Flex>\n            <ControlBar\n              showLabels={true}\n              responsive={true}\n              layout=\"undocked-horizontal\"\n            >\n              <ControlBarButton {...JoinButtonProps} />\n              <ControlBarButton {...LeaveButtonProps} />\n              <ControlBarButton {...EndButtonProps} />\n              <AudioInputControl />\n              <AudioOutputControl />\n              <VideoInputControl />\n            </ControlBar>\n          </Flex>\n          <Flex>\n            <Input\n              css=\"width: 20vh; height: 5vh\"\n              marginLeft=\"1rem\"\n              value={message}\n              onChange={handleMessageChange}\n              onKeyPress={handleKeyPress}\n              placeholder=\"Message all attendees\"\n            />\n          </Flex>\n        </Grid>\n      </div>\n    </NorthStarThemeProvider>\n  );\n};\n\nexport default App;\n","import { StrictMode } from \"react\";\nimport { createRoot } from \"react-dom/client\";\nimport { ThemeProvider } from \"styled-components\";\nimport {\n  MeetingProvider,\n  lightTheme\n} from \"amazon-chime-sdk-component-library-react\";\nimport App from \"./App\";\n\nconst rootElement = document.getElementById(\"root\");\nconst root = createRoot(rootElement);\n\nroot.render(\n  <StrictMode>\n    <ThemeProvider theme={lightTheme}>\n      <MeetingProvider>\n        <App />\n      </MeetingProvider>\n    </ThemeProvider>\n  </StrictMode>\n);\n"],"sourceRoot":""}